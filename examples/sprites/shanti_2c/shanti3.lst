mads 2.1.7 build 33 (1 Aug 24)
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\shanti3.asm
     1
     2 					icl 'hardware.inc'
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\hardware.inc
     1 				;GTIA ==============================
     2 = D000			GTIA	= $D000
     3 = D000			HPOSP=$D000 ; 53248 ; horizontal position player
     4 = D000			HPOSP0	= $D000
     5 = D001			HPOSP1	= $D001
     6 = D002			HPOSP2	= $D002
     7 = D003			HPOSP3	= $D003
     8
     9 = D004			HPOSM=53252         ; horizontal position missiles
    10 = D004			HPOSM0	= $D004
    11 = D005			HPOSM1	= $D005
    12 = D006			HPOSM2	= $D006
    13 = D007			HPOSM3	= $D007
    14
    15 = D008			SIZEP = $D008       ; horizontal size player
    16 = D008			SIZEP0	= $D008
    17 = D009			SIZEP1	= $D009
    18 = D00A			SIZEP2	= $D00A
    19 = D00B			SIZEP3	= $D00B
    20
    21 = D00C			SIZEM	= $D00C       ; horizontal size missile
    22
    23 = D00D			GRAFP0	= $D00D     ; direct player write access without Antic
    24 = D00E			GRAFP1	= $D00E
    25 = D00F			GRAFP2	= $D00F
    26 = D010			GRAFP3	= $D010
    27
    28 = D011			GRAFM	= $D011       ; direct missile write access without Antic
    29
    30 = D012			COLPM=$D012         ; color register player/missile
    31 = D012			COLPM0	= $D012     ; shadow is 704
    32 = D013			COLPM1	= $D013
    33 = D014			COLPM2	= $D014
    34 = D015			COLPM3	= $D015
    35
    36 = D016			COLPF=$D016         ; color register playfield
    37 = D016			COLPF0	= $D016     ; shadow is 708
    38 = D017			COLPF1	= $D017
    39 = D018			COLPF2	= $D018
    40 = D019			COLPF3	= $D019
    41
    42 = D01A			COLBAK	= $D01A     ; color register background (shadow is 712)
    43
    44 = D01A			COLBK	= $D01A 	;alias of COLBAK
    45
    46 				; .enum	@prior
    47 				; 	prior0	= %0
    48 				; 	prior1	= %1
    49 				; 	prior2	= %10
    50 				; 	prior4	= %100
    51 				; 	prior8	= %1000
    52 				; 	ply5	= %10000	; Fifth Player Enable
    53 				; 	mlc	= %100000	; Multiple Color Player Enable
    54 				; 	mode9	= %01000000
    55 				; 	mode10	= %10000000
    56 				; 	mode11	= %11000000
    57 				; .ende
    58
    59 = D01B			PRIOR	= $D01B       ; direction access for playfield to player/missiles
    60
    61 = D01C			VDELAY	= $D01C     ; hardware scrolling in low res player/missiles 1 bit only
    62
    63 				; .enum	@gractl
    64 				; 	missiles= %1
    65 				; 	players	= %10
    66 				; 	trigs	= %100
    67 				; .ende
    68
    69 = D01D			GRACTL	= $D01D     ; player/missiles on/off
    70 = D01E			HITCLR	= $D01E     ; clear all collision registers
    71 = D01F			CONSOL	= $D01F     ; status of START, OPTION, SELECT
    72
    73 				; collisions
    74 = D000			M0PF	= $D000
    75 = D001			M1PF	= $D001
    76 = D002			M2PF	= $D002
    77 = D003			M3PF	= $D003
    78
    79 = D004			P0PF	= $D004
    80 = D005			P1PF	= $D005
    81 = D006			P2PF	= $D006
    82 = D007			P3PF	= $D007
    83
    84 = D008			M0PL	= $D008
    85 = D009			M1PL	= $D009
    86 = D00A			M2PL	= $D00A
    87 = D00B			M3PL	= $D00B
    88
    89 = D00C			P0PL	= $D00C
    90 = D00D			P1PL	= $D00D
    91 = D00E			P2PL	= $D00E
    92 = D00F			P3PL	= $D00F
    93
    94 = D010			TRIG0	= $D010
    95 = D011			TRIG1	= $D011
    96 = D012			TRIG2	= $D012
    97 = D013			TRIG3	= $D013
    98
    99 = D014			PAL	= $D014 ; 53268 ; 1=PAL, $E=NTSC
   100
   101 				;Pokey ==============================
   102 = D200			POKEY	= $D200
   103
   104 = D200			AUDF1	= $D200
   105 = D202			AUDF2	= $D202
   106 = D204			AUDF3	= $D204
   107 = D206			AUDF4	= $D206
   108
   109 = D201			AUDC1	= $D201
   110 = D203			AUDC2	= $D203
   111 = D205			AUDC3	= $D205
   112 = D207			AUDC4	= $D207
   113
   114 = D200			POT0	= $D200
   115 = D201			POT1	= $D201
   116 = D202			POT2	= $D202
   117 = D203			POT3	= $D203
   118 = D204			POT4	= $D204
   119 = D205			POT5	= $D205
   120 = D206			POT6	= $D206
   121 = D207			POT7	= $D207
   122
   123 = D208			AUDCTL	= $D208
   124 = D208			ALLPOT	= $D208
   125 = D208			POTST	= $D208
   126
   127 = D209			STIMER	= $D209
   128
   129 = D209			KBCODE	= $D209
   130
   131 = D20A			SKRES	= $D20A
   132 = D20A			RANDOM	= $D20A
   133 = D20B			POTGO	= $D20B
   134 = D20D			SEROUT	= $D20D
   135 = D20D			SERIN	= $D20D
   136 = D20E			IRQEN	= $D20E
   137 = D20E			IRQST	= $D20E
   138 = D20F			SKCTL	= $D20F
   139 = D20F			SKSTAT	= $D20F
   140
   141 				;PIA ==============================
   142 = D300			PIA	= $D300
   143 = D300			PORTA	= $D300
   144 = D301			PORTB	= $D301
   145 = D302			PACTL	= $D302
   146 = D303			PBCTL	= $D303
   147
   148 				;ANTIC ==============================
   149 = D400			ANTIC	= $D400
   150
   151 				 .enum	@dmactl
   152 = 0000			 	blank	= %00
   153 = 0001			 	narrow	= %01
   154 = 0002			 	standard= %10
   155 = 0003			 	wide	= %11
   156 = 0004			 	missiles= %100
   157 = 0008			 	players	= %1000
   158 = 0010			 	lineX1	= %10000
   159 = 0000			 	lineX2	= %00000
   160 = 0020			 	dma	= %100000
   161 				 .ende
   162 				 
   163 = 003F			 scr48	= @dmactl(wide|dma|players|missiles|lineX1)		;screen 48b
   164 = 003E			 scr40	= @dmactl(standard|dma|players|missiles|lineX1)		;screen 40b
   165 = 003D			 scr32	= @dmactl(narrow|dma|players|missiles|lineX1)		;screen 32b
   166 				 
   167
   168 = D400			DMACTL	= $D400 ; DMA Register (Shadow of 559)
   169 = D401			CHACTL	= $D401 ; page to character list
   170
   171 = D402			DLISTL	= $D402 ; Start address of Display List
   172 = D403			DLISTH	= $D403
   173
   174 = D404			HSCROL	= $D404 ; horizontal scrolling in "color clocks"! Bitwise in high res (320pixel) not possible
   175
   176 = D405			VSCROL	= $D405 ; vertical scrolling
   177
   178 = D407			PMBASE	= $D407 ; Start off player/Missiles (1k (lowres) or 2k(highres))
   179
   180 = D409			CHBASE	= $D409 ; Start address of font
   181
   182 = D40A			WSYNC	= $D40A ;54282  ; insert value, hold on the 6502-CPU until next line
   183
   184 = D40B			VCOUNT	= $D40B ; 54283 ; vertical screen line / 2 at PAL 0-155, NTSC 0-131
   185
   186 = D40C			PENH	= $D40C
   187 = D40D			PENV	= $D40D
   188
   189 = D40E			NMIEN	= $D40E   ; mask for interrupts
   190 = D40F			NMIRES	= $D40F ; clear current interrupt register
   191 = D40F			NMIST	= $D40F   ; contains bit of current interrupt
   192
   193
   194 				;ANTIC display list commands
   195 = 0000			DL_E1	= $00     ; empty lines
   196 = 0010			DL_E2	= $10
   197 = 0020			DL_E3	= $20
   198 = 0030			DL_E4	= $30
   199 = 0040			DL_E5	= $40
   200 = 0050			DL_E6	= $50
   201 = 0060			DL_E7	= $60
   202 = 0070			DL_E8	= $70
   203
   204 = 0001			DL_JUMP	= $01   ;jump to adress and create one empty line
   205 = 0041			DL_LOOP	= $41   ;jump to adress and wait for vsync
   206 = 0040			DL_ADDRES	= $40 ;load memory counter
   207 = 0080			DL_DLI	= $80   ;dli interrupt
   208 = 0010			DL_HS	= $10     ;horizontal scroll
   209 = 0020			DL_VS	= $20     ;vertical scroll
   210
   211 				;BASIC XL GR-codes:
   212 = 0002			DL_GR0	= $02   ;text hi-res mode 40 bytes/line 8 pixel per line
   213 = 0003			DL_A3	  = $03   ;hi-res text mode 8x10 pixel char, 40 bytes/line 10 pixel per line
   214 = 0004			DL_GR12 = $04   ;text - 4+1 color, 1 line V
   215 = 0005			DL_GR13 = $05   ;text - 4+1 color, 2 line V
   216 = 0006			DL_GR1	= $06   ;4 color text mode 20 bytes/line, 1 line V
   217 = 0007			DL_GR2	= $07   ;4 color text mode 20 bytes/line, 2 line V
   218
   219 = 0008			DL_GR3	= $08   ;4 color graphics mode 10 bytes/line, 8 line V
   220 = 0009			DL_GR4	= $09   ;1 color graphics mode 10 bytes/line, 4 line V
   221 = 000A			DL_GR5	= $0A   ;4 color graphics mode, 20 bytes/line, 4 line V
   222 = 000B			DL_GR6	= $0B   ;1 color graphics mode, 20 bytes/line, 2 line V
   223 = 000C			DL_GR14	= $0C   ;1 color graphics mode, 20 bytes/line, 1 line V
   224 = 000D			DL_GR7	= $0D   ;4 color graphics mode, 40 bytes/line, 2 line V
   225 = 000E			DL_GR15	= $0E   ;4 color graphics mode, 40 bytes/line, 1 line V
   226 = 000F			DL_GR8	= $0F   ;graphics hi-res mode 40 bytes/line
   227
   228 				; GTIA Graphics modes
   229 = 000F			DL_GR9	= $0F   ;graphics hi-res mode 40 bytes/line PRIOR=$40
   230 = 000F			DL_GR10	= $0F   ;graphics hi-res mode 40 bytes/line PRIOR=$80
   231 = 000F			DL_GR11	= $0F   ;graphics hi-res mode 40 bytes/line PRIOR=$C0
   232
   233
   234
     3 					icl 'variable.inc'
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\variable.inc
     1 				; -*- text -*-
     2 				;fuer den WiNiFe-Compiler
     3 				;cdw by 'The Atari Team' 1989-2019
     4
     5 				; These are lot of used global variables for Atari XL Computer
     6 				; But not all!
     7
     8 				;  .LOCAL
     9
    10 				; Here the most important addresses only
    11
    12 = 0009			BOOT=9    ; 1
    13 = 000A			DOSVEC=10 ; 2
    14 = 000C			DOSINI=12 ; 2
    15
    16 = 000E			APPMHI=14 ; 2 bytes, after this we can begin with display list or graphics memory
    17 = 0010			POKMSK=16
    18 				; bit dec hex
    19 				;   7 128 $80 - Breakkey is possible (BRKKY: 566,567)
    20 				;   6  64 $40 - key interrupt possible
    21 				;   2   4 $04 - Interrupt 4. pokey timer is possible
    22 				;   1   2 $02 - Interrupt 2. pokey timer is possible
    23 				;   0   1 $01 - Interrupt 1. pokey timer is possible
    24
    25 = 0011			BRKKEY=17
    26 = 0012			RTCLOK=18 ; 18,19,20 3 byte Timer will increase every 1/50s (PAL)
    27
    28 = 0030			STATUS=48
    29
    30 = 0031			CHKSUM=49
    31
    32 = 0041			SOUNDR=65 ; 0 means no sound at disk IO
    33
    34 = 0042			CRITIC=66 ; !0 means no second VBI (faster ~50000 cycles less)
    35
    36 = 0049			ERRNO=73
    37
    38 = 004D			ATRACT=77 ; will increment every 5s, >128 color switch begin
    39
    40 				; Addresses from 80 - 122 will used by screen editor
    41 = 0050			TMPCHR=80
    42 = 0051			HOLD1=81
    43 = 0052			LMARGN=82 ; left start position
    44 = 0053			RMARGN=83 ; right margin
    45
    46 = 0054			ROWCRS=84 ; row position of the cursor
    47 = 0055			COLCRS=85 ; 85,86 colum position of the cursor
    48
    49 = 0057			DINDEX=87 ; type of graphics
    50 = 0058			SAVMSC=88 ; address of the left upper corner of the screen
    51 				; The 4 line text window is TXTMSC (660,661)
    52
    53 				; Address 90-98 are used by drawto/fill
    54 = 005A			OLDROW=90
    55 = 005B			OLDCOL=91 ; 91,92
    56
    57 = 005D			OLDCHR=93
    58 = 005E			OLDADR=94 ; 94,95
    59
    60 				; NEWROW=96
    61 				; NEWCOL=97 ; 97,98
    62
    63 = 0060			FKDEV=96 ; 96,97 Pointer to definition table of function keys (since 1200XL)
    64
    65 = 0062			PALNTS=98 ; 1 means PAL else NTSC
    66
    67 = 0063			LOGCOL=99 ; logical line position (max 3 lines)
    68
    69 = 0064			ADRESS=100 ; 100,101
    70 = 0066			MLTTMP=102 ; 102,103
    71 = 0068			SAVADR=104 ; 104,105
    72
    73 = 006A			RAMTOP=106 ; upper RAM memory page real adress is RAMTOP * 256
    74
    75 = 006B			BUFCNT=107 ; count of values in logical screen row
    76
    77 = 006C			BUFSTR=108
    78 = 006E			BITMSK=110
    79 = 006F			SHFAMT=111 ; for pixel shift in pixel graphics
    80 = 0070			ROWAC=112 ; 112,113 calc register for plot/drawto
    81 = 0072			COLAC=114 ; 114,115
    82 = 0074			ENDPT=116 ; 116,117
    83 = 0076			DELTAR=118
    84 = 0077			DELTAC=119 ; 119,120
    85 = 0079			KEYDEF=121 ; key definition table
    86 = 007B			SWPFLG=123
    87 = 007C			HOLDCH=124
    88 = 007D			INSDAT=125
    89 = 007E			COUNTR=126 ; 126,127 line draw counter
    90
    91 				; -----------------------------
    92 				; Address from 128 to 202 are used by Atari Basic
    93
    94 = 00CB			FREE=203 ; 203-211 in Atari Basic
    95
    96 				; ----------------------------------------------------------------
    97 				; Internal zero page registers used by wnf-compiler
    98 				; ----------------------------------------------------------------
    99 				; we try to use only the 42 bytes of floating-point-register
   100 				;
   101 = 00D4			BININT = 212                   ; return value for Atari Basic
   102
   103 = 00D4			@AUX  =   212
   104
   105 = 00D4			@PUTARRAY = 212                 ; 2 212 duerfen innerhalb von Expressions nicht ueberschrieben werden
   106 = 00D6			@GETARRAY = @PUTARRAY+2         ; 2 214 dito ; used in MACROS.INC
   107
   108 				; Math values (mult, div, modulo)
   109 = 00D8			@OP   =   @AUX + 4              ; 4 216
   110 				; Ergebnis, Produkt, REST
   111 = 00DC			@PRODUKT = @AUX+8               ; 2 220 ; used by IMULT
   112 = 00DC			@REST =   @AUX+8                ; 2 222 ; used by IDIV/IMODULO
   113
   114 = 00DE			@ERG  =   @AUX+10               ; 2 224 ; used by conditions
   115 = 00E0			@ISMODULO = @AUX+12             ; 1 226 ; used by IMODULO
   116 = 00E1			@NEGATIV = @AUX+13              ; 1 227 ; used by IDIV/IMODULO
   117
   118 				; working registers will always overwrite! Do not expect they will not changed after function call
   119 = 00E2			@REG  =   @AUX+14               ; 27 bytes (13 word-Register) 226
   120
   121 = 00FC			@PRINTF_TYPE = 252
   122 = 00FD			@COLOR_REGISTER = 253
   123 = 00FE			@HEAP_PTR = 254                 ; 2 bytes
   124
   125 				;
   126 				; -----------------------------
   127 = 0200			VDSLST = $200 ; Address of Displaylist interrupt
   128 = 0206			VBREAK = $206 ; if BRK (in Assembler) occured
   129 = 0208			VKEYBD = $208 ; key interrupt
   130
   131 				; Interrupt counters
   132 = 0218			CDTMV1 = 536
   133 = 021A			CDTMV2 = 538
   134 = 021C			CDTMV3 = 540
   135
   136 				; For Interrupts, many more then every 1/50s
   137 = 0210			VTIMR1 = 528 ; Pokey Interrupt 1 AUDF1 ist der Zaehler STIMER muss beschrieben werden
   138 = 0212			VTIMR2 = 530 ; Pokey Interrupt 2
   139 = 0214			VTIMR4 = 532 ; Pokey Interrupt 4
   140
   141 = 0216			VIMIRQ = 534
   142 = 0222			VVBLKI = 546 ; System VBI   Interrupt vektor (SETVBV with A=6, Address -> (Y,X), at exit JMP SYSVBV
   143 = 0224			VVBLKD = 548 ; Deferred VBI Interrupt vektor (SETVBV with A=7, Address -> (Y,X), at exit JMP XITVBV
   144 = 0226			CDTMA1 = 550
   145 = 0228			CDTMA2 = 552 ; (SETVBV with A=2, Address -> (Y,X), at exit RTS
   146
   147 = 022B			SRTIMR = 555 ; Tastaturwiederholfrequenz
   148
   149 = 022F			SDMCTL = 559 ; Shadow register of ANTIC DMA Controller
   150 				; 32 - DMA for display list
   151 				; 16 - single line Player Missiles
   152 				;  8 - DMA Player
   153 				;  4 - DMA Missiles
   154 				;  3 - wide screen (48 bytes)
   155 				;  2 - normal screen width (40 bytes)
   156 				;  1 - small screen width (32 bytes)
   157 				;  0 - no screen
   158
   159 = 0230			SDLSTL=560 ; Shadow register of current Displaylist
   160
   161 = 0236			BRKKY=566 ; vektor called if break key is pressed
   162
   163 = 0244			COLDST=580 ; =0 heißt warm-reset, sonst cold-reset, default ist 255
   164
   165 = 026F			GPRIOR=623 ; Shadow register GTIA Chip (bit 7,6 graphics 11,10,9) other player missiles
   166 				; 192 - 16 color one hue (712 is hue)
   167 				; 128 - 9 colors (704-712 colors) there are no more color registers in HW
   168 				;  64 - 16 hue one color (712 is color)
   169 				;  32 - overlap player third color
   170 				;  16 - 4 missiles will be 5th player (711 is color)
   171 				;   8 - screen 0-1, player 0-3, screen 2-3, background
   172 				;   4 - screen 0-3, player 0-3, background
   173 				;   2 - player 0-1, screen 0-3, player 2-3, background
   174 				;   1 - player 0-3, screen 0-3, background
   175
   176 = 0290			TXTROW=656
   177 = 0291			TXTCOL=657 ;2 bytes
   178 = 0293			TINDEX=659
   179 = 0294			TXTMSC=660 ;2 bytes
   180
   181 = 02C0			PCOLR=704
   182 				; COLOR=708
   183
   184 = 02D9			KRPDEL=729 ; Tastatur Ansprechfrequenz
   185 = 02DA			KEYREP=730 ; Tastatur Wiederholfrequenz
   186
   187 = 02DB			NOCLIK=731 ; 0=click other value, no click
   188
   189 = 02E0			RUNAD=736
   190 = 02E2			INITAD=738
   191
   192 = 02F3			CHACT=755  ; Shadow register of CHACTL
   193 = 02F4			CHBAS=756  ; Shadow register of font CHBASE
   194 = 02FC			CH=764     ; last pressed key, to reset last key insert value 255
   195 				; bit 7 set, control pressed
   196 				; bit 6 set, shift pressed
   197 				; other bit key code
   198
   199 = 0461			CASBUF=1121 ; 130 Bytes, die eigentlich als Cassettenbuffer verwendet wurden, nutzen wir in @input und @readline
   200
   201 = 0580			LBUFF=$580 ; wird eigentlich von FloatingPoint verwendet.
   202
   203 				; -----------------------------
   204 				; OS-Handler Addresses
   205 = E400			EDITRV = $E400  ; Editor
   206 = E410			SCRENV = $E410  ; Screen
   207 = E420			KEYBDV = $E420  ; Keyboard
   208
   209 				; Input over Keyboard only
   210
   211 = 0340			ICHID =   832+0 ; Handleridentifizierung
   212 = 0341			ICDNO =   832+1 ; Devicenummer e.g. D1:
   213 = 0342			ICCOM =   832+2 ; Befehlsbyte
   214 = 0343			ICSTA =   832+3 ; Status
   215 = 0344			ICBADR =  832+4 ; :2 Adresse Filebuffer oder Filename
   216 = 0346			ICPUT =   832+6 ; :2
   217 = 0348			ICBLEN =  832+8 ; :2 Laenge des Buffers
   218 = 034A			ICAUX1 =  832+10 ; nach Open nicht verwenden
   219 = 034B			ICAUX2 =  832+11 ; nach Open nicht verwenden
   220 = 034C			ICAUX3 =  832+12
   221 = 034D			ICAUX4 =  832+13
   222 = 034E			ICAUX5 =  832+14
   223 = 034F			ICAUX6 =  832+15
   224
   225 = E456			CIOV  =   $E456
   226
   227 = 0003			CIO_OPEN	= 3
   228 = 0005			CIO_GETTEXT	= 5
   229 = 0007			CIO_GETDATA	= 7
   230 = 0009			CIO_PUTTEXT	= 9
   231 = 000B			CIO_PUTDATA	= 11
   232 = 000C			CIO_CLOSE	= 12
   233 = 000D			CIO_GETSTATUS	= 13
   234 = 0004			CIO_READ	= 4
   235 = 0008			CIO_WRITE	= 8
   236 = 0006			CIO_DIR	= 6
   237
   238 				; Interrupts -----
   239 = E45C			SETVBV=$E45C
   240 = E45F			SYSVBV=$E45F
   241 = E462			XITVBV=$E462
     4
     5 = 0001			DEBUG = 1
     6
     7 = 0018			MAX_SPRITES = 24
     8
     9 = 0030			PM_X_OFFSET = 48
    10 = 0020			PM_Y_OFFSET = 32
    11
    12
    13 					org $2000
    14
    15
    16 				; this Display list corresponds to a normal Graphics 0 display list, only with a lot of extra DLIs
    17
    18 				@displaylist
    19 FFFF> 2000-2342> 70	 .byte DL_E8
    20 2001 F0			 .byte DL_E8|DL_DLI
    21 2002 F0			 .byte DL_E8|DL_DLI
    22 2003 C2			 .byte DL_ADDRES|DL_GR0|DL_DLI
    23 2004 40 BC		 .word $BC40
    24 2006 82			 .byte DL_GR0|DL_DLI
    25 2007 82			 .byte DL_GR0|DL_DLI
    26 2008 82			 .byte DL_GR0|DL_DLI
    27 2009 82			 .byte DL_GR0|DL_DLI
    28 200A 82			 .byte DL_GR0|DL_DLI
    29 200B 82			 .byte DL_GR0|DL_DLI
    30 200C 82			 .byte DL_GR0|DL_DLI
    31 200D 82			 .byte DL_GR0|DL_DLI
    32 200E 82			 .byte DL_GR0|DL_DLI
    33 200F 82			 .byte DL_GR0|DL_DLI
    34 2010 82			 .byte DL_GR0|DL_DLI
    35 2011 82			 .byte DL_GR0|DL_DLI
    36 2012 82			 .byte DL_GR0|DL_DLI
    37 2013 82			 .byte DL_GR0|DL_DLI
    38 2014 82			 .byte DL_GR0|DL_DLI
    39 2015 82			 .byte DL_GR0|DL_DLI
    40 2016 82			 .byte DL_GR0|DL_DLI
    41 2017 82			 .byte DL_GR0|DL_DLI
    42 2018 82			 .byte DL_GR0|DL_DLI
    43 2019 82			 .byte DL_GR0|DL_DLI
    44 201A 82			 .byte DL_GR0|DL_DLI
    45 201B 82			 .byte DL_GR0|DL_DLI
    46 201C 82			 .byte DL_GR0|DL_DLI
    47
    48 				; .byte DL_E8|DL_DLI
    49 201D 41			 .byte DL_LOOP
    50 201E 00 20		 .word @displaylist
    51
    52
    53 2020			main
    54 2020 A5 14 C5 14 F0 FC		lda:cmp:req 20
    55
    56 2026 20 86 22			jsr @init_vbi
    57 2029 20 A4 22			jsr @start_displaylist_interrupts
    58
    59 202C A9 3E 8D 2F 02		mva #scr40 sdmctl
    60
    61
    62 2031 A9 01 8D 6F 02		mva #$01 gprior
    63
    64 2036 A9 03 8D 1D D0		mva #3 gractl
    65
    66 203B A9 B0 8D 07 D4		mva >pmadr pmbase
    67
    68
    69 2040 20 A0 25			jsr @init_sprites
    70
    71
    72 					.rept 18
    73 					LDA #[$0A+#*16]&$FF
    74 					STA @SPRITE_COLOR+#
    76 					LDA #[#]
    77 					STA @SPRITE_SHAPE+#
    79 					LDA #PM_Y_OFFSET+#*8
    80 					STA @SPRITE_Y+#
    82 					LDA #PM_X_OFFSET+#*9
    83 					STA @SPRITE_X+#
    84 					.endr
Source: REPT
    73 2043 A9 0A			LDA #[$0A+#*16]&$FF
    73 2045 8D 88 25			STA @SPRITE_COLOR+#
    73 2048 A9 00			LDA #[#]
    73 204A 8D 70 25			STA @SPRITE_SHAPE+#
    73 204D A9 20			LDA #PM_Y_OFFSET+#*8
    73 204F 8D 58 25			STA @SPRITE_Y+#
    73 2052 A9 30			LDA #PM_X_OFFSET+#*9
    73 2054 8D 40 25			STA @SPRITE_X+#
    73 2057 A9 1A			LDA #[$0A+#*16]&$FF
    73 2059 8D 89 25			STA @SPRITE_COLOR+#
    73 205C A9 01			LDA #[#]
    73 205E 8D 71 25			STA @SPRITE_SHAPE+#
    73 2061 A9 28			LDA #PM_Y_OFFSET+#*8
    73 2063 8D 59 25			STA @SPRITE_Y+#
    73 2066 A9 39			LDA #PM_X_OFFSET+#*9
    73 2068 8D 41 25			STA @SPRITE_X+#
    73 206B A9 2A			LDA #[$0A+#*16]&$FF
    73 206D 8D 8A 25			STA @SPRITE_COLOR+#
    73 2070 A9 02			LDA #[#]
    73 2072 8D 72 25			STA @SPRITE_SHAPE+#
    73 2075 A9 30			LDA #PM_Y_OFFSET+#*8
    73 2077 8D 5A 25			STA @SPRITE_Y+#
    73 207A A9 42			LDA #PM_X_OFFSET+#*9
    73 207C 8D 42 25			STA @SPRITE_X+#
    73 207F A9 3A			LDA #[$0A+#*16]&$FF
    73 2081 8D 8B 25			STA @SPRITE_COLOR+#
    73 2084 A9 03			LDA #[#]
    73 2086 8D 73 25			STA @SPRITE_SHAPE+#
    73 2089 A9 38			LDA #PM_Y_OFFSET+#*8
    73 208B 8D 5B 25			STA @SPRITE_Y+#
    73 208E A9 4B			LDA #PM_X_OFFSET+#*9
    73 2090 8D 43 25			STA @SPRITE_X+#
    73 2093 A9 4A			LDA #[$0A+#*16]&$FF
    73 2095 8D 8C 25			STA @SPRITE_COLOR+#
    73 2098 A9 04			LDA #[#]
    73 209A 8D 74 25			STA @SPRITE_SHAPE+#
    73 209D A9 40			LDA #PM_Y_OFFSET+#*8
    73 209F 8D 5C 25			STA @SPRITE_Y+#
    73 20A2 A9 54			LDA #PM_X_OFFSET+#*9
    73 20A4 8D 44 25			STA @SPRITE_X+#
    73 20A7 A9 5A			LDA #[$0A+#*16]&$FF
    73 20A9 8D 8D 25			STA @SPRITE_COLOR+#
    73 20AC A9 05			LDA #[#]
    73 20AE 8D 75 25			STA @SPRITE_SHAPE+#
    73 20B1 A9 48			LDA #PM_Y_OFFSET+#*8
    73 20B3 8D 5D 25			STA @SPRITE_Y+#
    73 20B6 A9 5D			LDA #PM_X_OFFSET+#*9
    73 20B8 8D 45 25			STA @SPRITE_X+#
    73 20BB A9 6A			LDA #[$0A+#*16]&$FF
    73 20BD 8D 8E 25			STA @SPRITE_COLOR+#
    73 20C0 A9 06			LDA #[#]
    73 20C2 8D 76 25			STA @SPRITE_SHAPE+#
    73 20C5 A9 50			LDA #PM_Y_OFFSET+#*8
    73 20C7 8D 5E 25			STA @SPRITE_Y+#
    73 20CA A9 66			LDA #PM_X_OFFSET+#*9
    73 20CC 8D 46 25			STA @SPRITE_X+#
    73 20CF A9 7A			LDA #[$0A+#*16]&$FF
    73 20D1 8D 8F 25			STA @SPRITE_COLOR+#
    73 20D4 A9 07			LDA #[#]
    73 20D6 8D 77 25			STA @SPRITE_SHAPE+#
    73 20D9 A9 58			LDA #PM_Y_OFFSET+#*8
    73 20DB 8D 5F 25			STA @SPRITE_Y+#
    73 20DE A9 6F			LDA #PM_X_OFFSET+#*9
    73 20E0 8D 47 25			STA @SPRITE_X+#
    73 20E3 A9 8A			LDA #[$0A+#*16]&$FF
    73 20E5 8D 90 25			STA @SPRITE_COLOR+#
    73 20E8 A9 08			LDA #[#]
    73 20EA 8D 78 25			STA @SPRITE_SHAPE+#
    73 20ED A9 60			LDA #PM_Y_OFFSET+#*8
    73 20EF 8D 60 25			STA @SPRITE_Y+#
    73 20F2 A9 78			LDA #PM_X_OFFSET+#*9
    73 20F4 8D 48 25			STA @SPRITE_X+#
    73 20F7 A9 9A			LDA #[$0A+#*16]&$FF
    73 20F9 8D 91 25			STA @SPRITE_COLOR+#
    73 20FC A9 09			LDA #[#]
    73 20FE 8D 79 25			STA @SPRITE_SHAPE+#
    73 2101 A9 68			LDA #PM_Y_OFFSET+#*8
    73 2103 8D 61 25			STA @SPRITE_Y+#
    73 2106 A9 81			LDA #PM_X_OFFSET+#*9
    73 2108 8D 49 25			STA @SPRITE_X+#
    73 210B A9 AA			LDA #[$0A+#*16]&$FF
    73 210D 8D 92 25			STA @SPRITE_COLOR+#
    73 2110 A9 0A			LDA #[#]
    73 2112 8D 7A 25			STA @SPRITE_SHAPE+#
    73 2115 A9 70			LDA #PM_Y_OFFSET+#*8
    73 2117 8D 62 25			STA @SPRITE_Y+#
    73 211A A9 8A			LDA #PM_X_OFFSET+#*9
    73 211C 8D 4A 25			STA @SPRITE_X+#
    73 211F A9 BA			LDA #[$0A+#*16]&$FF
    73 2121 8D 93 25			STA @SPRITE_COLOR+#
    73 2124 A9 0B			LDA #[#]
    73 2126 8D 7B 25			STA @SPRITE_SHAPE+#
    73 2129 A9 78			LDA #PM_Y_OFFSET+#*8
    73 212B 8D 63 25			STA @SPRITE_Y+#
    73 212E A9 93			LDA #PM_X_OFFSET+#*9
    73 2130 8D 4B 25			STA @SPRITE_X+#
    73 2133 A9 CA			LDA #[$0A+#*16]&$FF
    73 2135 8D 94 25			STA @SPRITE_COLOR+#
    73 2138 A9 0C			LDA #[#]
    73 213A 8D 7C 25			STA @SPRITE_SHAPE+#
    73 213D A9 80			LDA #PM_Y_OFFSET+#*8
    73 213F 8D 64 25			STA @SPRITE_Y+#
    73 2142 A9 9C			LDA #PM_X_OFFSET+#*9
    73 2144 8D 4C 25			STA @SPRITE_X+#
    73 2147 A9 DA			LDA #[$0A+#*16]&$FF
    73 2149 8D 95 25			STA @SPRITE_COLOR+#
    73 214C A9 0D			LDA #[#]
    73 214E 8D 7D 25			STA @SPRITE_SHAPE+#
    73 2151 A9 88			LDA #PM_Y_OFFSET+#*8
    73 2153 8D 65 25			STA @SPRITE_Y+#
    73 2156 A9 A5			LDA #PM_X_OFFSET+#*9
    73 2158 8D 4D 25			STA @SPRITE_X+#
    73 215B A9 EA			LDA #[$0A+#*16]&$FF
    73 215D 8D 96 25			STA @SPRITE_COLOR+#
    73 2160 A9 0E			LDA #[#]
    73 2162 8D 7E 25			STA @SPRITE_SHAPE+#
    73 2165 A9 90			LDA #PM_Y_OFFSET+#*8
    73 2167 8D 66 25			STA @SPRITE_Y+#
    73 216A A9 AE			LDA #PM_X_OFFSET+#*9
    73 216C 8D 4E 25			STA @SPRITE_X+#
    73 216F A9 FA			LDA #[$0A+#*16]&$FF
    73 2171 8D 97 25			STA @SPRITE_COLOR+#
    73 2174 A9 0F			LDA #[#]
    73 2176 8D 7F 25			STA @SPRITE_SHAPE+#
    73 2179 A9 98			LDA #PM_Y_OFFSET+#*8
    73 217B 8D 67 25			STA @SPRITE_Y+#
    73 217E A9 B7			LDA #PM_X_OFFSET+#*9
    73 2180 8D 4F 25			STA @SPRITE_X+#
    73 2183 A9 0A			LDA #[$0A+#*16]&$FF
    73 2185 8D 98 25			STA @SPRITE_COLOR+#
    73 2188 A9 10			LDA #[#]
    73 218A 8D 80 25			STA @SPRITE_SHAPE+#
    73 218D A9 A0			LDA #PM_Y_OFFSET+#*8
    73 218F 8D 68 25			STA @SPRITE_Y+#
    73 2192 A9 C0			LDA #PM_X_OFFSET+#*9
    73 2194 8D 50 25			STA @SPRITE_X+#
    73 2197 A9 1A			LDA #[$0A+#*16]&$FF
    73 2199 8D 99 25			STA @SPRITE_COLOR+#
    73 219C A9 11			LDA #[#]
    73 219E 8D 81 25			STA @SPRITE_SHAPE+#
    73 21A1 A9 A8			LDA #PM_Y_OFFSET+#*8
    73 21A3 8D 69 25			STA @SPRITE_Y+#
    73 21A6 A9 C9			LDA #PM_X_OFFSET+#*9
    73 21A8 8D 51 25			STA @SPRITE_X+#
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\shanti3.asm
    85
    86
    87 21AB A5 14 C5 14 F0 FC	lp	lda:cmp:req 20
    88
    89 21B1 20 BB 25			jsr @show_sprites
    90 					
    91 21B4 A5 14			lda 20
    92 21B6 29 03			and #3
    93 21B8 F0 03 4C 83 22		jne skp
    94
    95 					.rept 18
    96 					
    97 					INC @SPRITE_SHAPE+#
    98 					LDA @SPRITE_SHAPE+#
    99 					AND #$0F
   100 					STA @SPRITE_SHAPE+#
   101 					
   102 					.endr
Source: REPT
    96 					
    96 21BD EE 70 25			INC @SPRITE_SHAPE+#
    96 21C0 AD 70 25			LDA @SPRITE_SHAPE+#
    96 21C3 29 0F			AND #$0F
    96 21C5 8D 70 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 21C8 EE 71 25			INC @SPRITE_SHAPE+#
    96 21CB AD 71 25			LDA @SPRITE_SHAPE+#
    96 21CE 29 0F			AND #$0F
    96 21D0 8D 71 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 21D3 EE 72 25			INC @SPRITE_SHAPE+#
    96 21D6 AD 72 25			LDA @SPRITE_SHAPE+#
    96 21D9 29 0F			AND #$0F
    96 21DB 8D 72 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 21DE EE 73 25			INC @SPRITE_SHAPE+#
    96 21E1 AD 73 25			LDA @SPRITE_SHAPE+#
    96 21E4 29 0F			AND #$0F
    96 21E6 8D 73 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 21E9 EE 74 25			INC @SPRITE_SHAPE+#
    96 21EC AD 74 25			LDA @SPRITE_SHAPE+#
    96 21EF 29 0F			AND #$0F
    96 21F1 8D 74 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 21F4 EE 75 25			INC @SPRITE_SHAPE+#
    96 21F7 AD 75 25			LDA @SPRITE_SHAPE+#
    96 21FA 29 0F			AND #$0F
    96 21FC 8D 75 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 21FF EE 76 25			INC @SPRITE_SHAPE+#
    96 2202 AD 76 25			LDA @SPRITE_SHAPE+#
    96 2205 29 0F			AND #$0F
    96 2207 8D 76 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 220A EE 77 25			INC @SPRITE_SHAPE+#
    96 220D AD 77 25			LDA @SPRITE_SHAPE+#
    96 2210 29 0F			AND #$0F
    96 2212 8D 77 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2215 EE 78 25			INC @SPRITE_SHAPE+#
    96 2218 AD 78 25			LDA @SPRITE_SHAPE+#
    96 221B 29 0F			AND #$0F
    96 221D 8D 78 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2220 EE 79 25			INC @SPRITE_SHAPE+#
    96 2223 AD 79 25			LDA @SPRITE_SHAPE+#
    96 2226 29 0F			AND #$0F
    96 2228 8D 79 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 222B EE 7A 25			INC @SPRITE_SHAPE+#
    96 222E AD 7A 25			LDA @SPRITE_SHAPE+#
    96 2231 29 0F			AND #$0F
    96 2233 8D 7A 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2236 EE 7B 25			INC @SPRITE_SHAPE+#
    96 2239 AD 7B 25			LDA @SPRITE_SHAPE+#
    96 223C 29 0F			AND #$0F
    96 223E 8D 7B 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2241 EE 7C 25			INC @SPRITE_SHAPE+#
    96 2244 AD 7C 25			LDA @SPRITE_SHAPE+#
    96 2247 29 0F			AND #$0F
    96 2249 8D 7C 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 224C EE 7D 25			INC @SPRITE_SHAPE+#
    96 224F AD 7D 25			LDA @SPRITE_SHAPE+#
    96 2252 29 0F			AND #$0F
    96 2254 8D 7D 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2257 EE 7E 25			INC @SPRITE_SHAPE+#
    96 225A AD 7E 25			LDA @SPRITE_SHAPE+#
    96 225D 29 0F			AND #$0F
    96 225F 8D 7E 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2262 EE 7F 25			INC @SPRITE_SHAPE+#
    96 2265 AD 7F 25			LDA @SPRITE_SHAPE+#
    96 2268 29 0F			AND #$0F
    96 226A 8D 7F 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 226D EE 80 25			INC @SPRITE_SHAPE+#
    96 2270 AD 80 25			LDA @SPRITE_SHAPE+#
    96 2273 29 0F			AND #$0F
    96 2275 8D 80 25			STA @SPRITE_SHAPE+#
    96 					
    96 					
    96 2278 EE 81 25			INC @SPRITE_SHAPE+#
    96 227B AD 81 25			LDA @SPRITE_SHAPE+#
    96 227E 29 0F			AND #$0F
    96 2280 8D 81 25			STA @SPRITE_SHAPE+#
    96 					
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\shanti3.asm
   103
   104 2283			skp
   105 					;:16 inc @sprite_y+#
   106
   107
   108 2283 4C AB 21			jmp lp
   109
   110
   111 2286				icl 'dli.asm'
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\dli.asm
     1 				; -*- text -*-
     2 				;
     3 				; VBI and Display List Interrupts
     4 				;
     5
     6 2286			@init_vbi
     7 2286 AD 22 02		     lda VVBLKI
     8 2289 8D AB 22		     sta store_vvblki
     9 228C AD 23 02		     lda VVBLKI+1
    10 228F 8D AC 22		     sta store_vvblki+1
    11
    12 2292 20 9E 22		     jsr @stop_displaylist_interrupts
    13
    14 2295 A9 06		     LDA #6           ; use inferred(6) VBI
    15 2297 A0 B8		     LDY #<GAME_VBI
    16 2299 A2 22		     LDX #>GAME_VBI
    17 229B 4C 5C E4		     JMP SETVBV
    18
    19 229E			@stop_displaylist_interrupts
    20 229E A9 40		    lda #$40
    21 22A0 8D AA 22		    sta nmien_value
    22 22A3 60			    rts
    23
    24
    25 22A4			@start_displaylist_interrupts
    26 22A4 A9 C0		    lda #$c0
    27 22A6 8D AA 22		    sta nmien_value
    28 22A9 60			    rts
    29
    30 22AA			nmien_value
    31 22AA 00			 .byte 0
    32
    33 22AB			store_vvblki
    34 22AB 00 00		 .word 0
    35
    36 22AD			@deinit_vbi
    37 22AD A9 06		     LDA #6         ; use inferred(6) VBI
    38 22AF AC AB 22		     LDY store_vvblki
    39 22B2 AE AC 22		     LDX store_vvblki+1
    40 22B5 4C 5C E4		     JMP SETVBV
    41
    42 				;
    43 				; OO   OO OOOOO  OOOO
    44 				; OO   OO OO  OO  OO
    45 				; OO   OO OO  OO  OO
    46 				; OO   OO OOOOO   OO
    47 				; OO   OO OO  OO  OO
    48 				;  OO OO  OO  OO  OO
    49 				;   OOO   OOOOO  OOOO
    50 				;
    51
    52
    53 22B8			GAME_VBI
    54 22B8 A9 00		     LDA #0
    55 22BA 85 4D		     STA 77              ; no colorswitch
    56
    57 22BC A9 00		     LDA #$0
    58 22BE 8D 0E D4		     STA NMIEN           ; Displaylist Interrupt must not occur
    59
    60 22C1 A9 03		     lda #3
    61 22C3 8D ED 22		     sta meter
    62
    63 				; Show Game Screen
    64 22C6 A9 00		     LDA #<@displaylist  ; Game Screen
    65 22C8 8D 30 02		     STA SDLSTL
    66 22CB A9 20		     LDA #>@displaylist
    67 22CD 8D 31 02		     STA SDLSTL+1
    68
    69 22D0 A9 E3		     LDA #<DLI
    70 22D2 8D 00 02		     STA VDSLST
    71 22D5 A9 22		     LDA #>DLI
    72 22D7 8D 01 02		     STA VDSLST+1
    73
    74 22DA AD AA 22		     LDA nmien_value
    75 22DD 8D 0E D4		     STA NMIEN           ; Displaylist Interrupt are possible
    76 22E0 4C 5F E4		     JMP SYSVBV
    77
    78
    79 				; OOOOO  OO     OOOO
    80 				; OO  OO OO      OO
    81 				; OO  OO OO      OO
    82 				; OO  OO OO      OO
    83 				; OO  OO OO      OO
    84 				; OO  OO OO      OO
    85 				; OOOOO  OOOOOO OOOO
    86
    87 22E3			DLI
    88 22E3 48			 pha
    89 				 
    90 				 ift DEBUG
    91
    92 22E4 A9 08		 lda #8               ; shows a gray line
    93 22E6 8D 1A D0		 sta colbk
    94 				 
    95 				 eif
    96
    97
    98 				; Multi sprite interrupt, must be called every 8 screen lines (in gr.0 or gr.12 every Displaylist line!)
    99
   100 22E9 8E 3B 23					stx regX
   101
   102
   103 22EC A2 00					ldx meter: #$00                 ; y position div 8
   104
   105 22EE BD 80 24					lda block_x0,x			;player 0
   106 22F1 F0 09					beq no_sprite0
   107
   108 22F3 8D 00 D0					sta hposp0
   109
   110 22F6 BD 00 24					lda block_c0,x
   111 22F9 8D 12 D0					sta colpm0
   112
   113 22FC			no_sprite0
   114 22FC BD A0 24					lda block_x1,x			;player 1
   115 22FF F0 09					beq no_sprite1
   116
   117 2301 8D 01 D0					sta hposp1
   118
   119 2304 BD 20 24					lda block_c1,x
   120 2307 8D 13 D0					sta colpm1
   121
   122 230A			no_sprite1
   123 230A BD C0 24					lda block_x2,x			;player 2
   124 230D F0 09					beq no_sprite2
   125
   126 230F 8D 02 D0					sta hposp2
   127
   128 2312 BD 40 24					lda block_c2,x
   129 2315 8D 14 D0					sta colpm2
   130
   131 2318			no_sprite2
   132 2318 BD E0 24					lda block_x3,x			;player 3
   133 231B F0 09					beq no_sprite3
   134
   135 231D 8D 03 D0					sta hposp3
   136
   137 2320 BD 60 24					lda block_c3,x
   138 2323 8D 15 D0					sta colpm3
   139
   140 2326			no_sprite3
   141 2326 A9 00					lda #0			        ; clear the current block
   142 2328 9D 80 24					sta block_x0,x
   143 232B 9D A0 24					sta block_x1,x
   144 232E 9D C0 24					sta block_x2,x
   145 2331 9D E0 24					sta block_x3,x
   146 2334 9D 20 25					sta block_status,x
   147
   148 2337 EE ED 22					inc meter
   149
   150 233A			dli_end
   151
   152 233A A2 00			ldx regX: #$00
   153
   154 				 ift DEBUG
   155
   156 233C A9 00		 lda #0
   157 233E 8D 1A D0		 sta colbk
   158
   159 				 eif
   160
   161 2341 68			 pla
   162 2342 40			 rti
   112
   113 2343				icl 'multi-sprite-multiplexer.asm'
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm
     1 				; -*- text -*-
     2 				; Multisprite Multiplexer
     3 				;cdw by 'The Atari Team' 2022
     4 				;
     5 				; Written for Night Knight
     6 				;
     7 				; based on Shanti77 & tebe code, thanks for that code!
     8
     9 				; The Atari 8bit has 4 Players. they take the whole screen in the hight.
    10 				; This code helps to display more than 16 sprites on a screen at the same time. 8bit wide, 16 lines high.
    11 				; We need a DLI every 8th display line, they must be at the right position.
    12 				; If we accept flickering, more than 4 sprites can be shown in the same horizontal height.
    13 				; But you should limit it to 8 sprites the same horizontal height.
    14 				; On old tube monitor with a slightly trailing plasma layer these flickering is not very strong.
    15 				; In Altirra Emulator you can set Frame blending on in the video configuration.
    16 				; On current LED/LCD/OLED Displays it will flicker little bit stronger.
    17 				;
    18 				; You must create a
    19 				; word array @all_sprite_data_table[1] = [...]
    20 				; Every sprite data to display need an entry in this table.
    21 				; The value of @sprite_shape[i] shows into this table and copy it's data to the player memory to show on screen.
    22 				; Which player is used for display isn't fix and vary, only the first sprite is fix and will also NOT flicker.
    23 				; Use the first sprite for your own game figure.
    24 				; Collision detection is a challenge.
    25 				;
    26 				; The source code is a little bit lengthy, we use lot of unroll-loop here.
    27 				; Especially when writing the data, no loop constructs are used.
    28 				;
    29 				; Later tests will have to show how many sprites can be displayed on NTSC systems
    30 				;
    31 				; Restrictions:
    32 				; You can't draw sprites over the first DLI + 8 screen lines
    33 				; You can't draw sprites under the last DLI
    34 				; You should not show more than 8 sprites in horizontal
    35
    36 				; changes: 18.03.2024 Tebe/Madteam
    37
    38
    39 = B000			pmadr = $B000
    40
    41
    42 2343				.align
    43
    44 = 2400			block_c0     .ds 32    ; Sprite color 0
    45 = 2420			block_c1     .ds 32
    46 = 2440			block_c2     .ds 32
    47 = 2460			block_c3     .ds 32
    48
    49 = 2480			block_x0     .ds 32    ; Sprite Positionen 0
    50 = 24A0			block_x1     .ds 32    ; Sprite Positionen 1
    51 = 24C0			block_x2     .ds 32    ; Sprite Positionen 2
    52 = 24E0			block_x3     .ds 32    ; Sprite Positionen 3
    53
    54 					ert <*<>0
    55
    56 2500			tab_print_sprite
    57
    58 2500-251F> 33 26			dta a(print_sprite_0)		; 0000
    59 2502 50 27			dta a(print_sprite_1)		; 0001
    60 2504 33 26			dta a(print_sprite_0)		; 0010
    61 2506 77 28			dta a(print_sprite_2)		; 0011
    62 2508 33 26			dta a(print_sprite_0)		; 0100
    63 250A 50 27			dta a(print_sprite_1)		; 0101
    64 250C 33 26			dta a(print_sprite_0)		; 0110
    65 250E 9E 29			dta a(print_sprite_3)		; 0111
    66 2510 33 26			dta a(print_sprite_0)		; 1000
    67 2512 50 27			dta a(print_sprite_1)		; 1001
    68 2514 33 26			dta a(print_sprite_0)		; 1010
    69 2516 77 28			dta a(print_sprite_2)		; 1011
    70 2518 33 26			dta a(print_sprite_0)		; 1100
    71 251A 50 27			dta a(print_sprite_1)		; 1101
    72 251C 33 26			dta a(print_sprite_0)		; 1110
    73 251E 29 26			dta a(print_sprite_null)	; 1111
    74
    75 = 2520			block_status .ds 32    ; help table for determining the occupation of sprites
    76
    77
    78 2540			@sprite_x
    79 = 2540			 .DS MAX_SPRITES
    80
    81 2558			@sprite_y
    82 = 2558			 .DS MAX_SPRITES
    83
    84 2570			@sprite_shape
    85 = 2570			 .DS MAX_SPRITES
    86
    87 2588			@sprite_color
    88 = 2588			 .DS MAX_SPRITES
    89
    90
    91 				.print 'data: ',*-block_c0
    91 				data: $01A0
    92
    93
    94
    95 				; Sprite initialization
    96 25A0			@init_sprites
    97 25A0-2AC4> A9 17		    lda #MAX_SPRITES-1
    98 25A2 8D D9 25		    sta last_sprite
    99
   100 25A5 A9 00		    lda #0
   101 25A7 AA			    tax
   102 25A8			loop2
   103 25A8 9D 00 B3		    sta pmadr+$300,x        ; clear Player/Missiles memory
   104 25AB 9D 00 B4		    sta pmadr+$400,x
   105 25AE 9D 00 B5		    sta pmadr+$500,x
   106 25B1 9D 00 B6		    sta pmadr+$600,x
   107 25B4 9D 00 B7		    sta pmadr+$700,x
   108 25B7 CA			    dex
   109 25B8 D0 EE		    bne loop2
   110
   111 25BA 60			    rts
   112
   113
   114 				;
   115 				;     OO                                                    OO    OO
   116 				;     OO                                                          OO
   117 				;  OOOOO OOOOO   OOOOO OO   OO         OOOO  OOOOO  OOOOO  OOO  OOOOOO  OOOO   OOOO
   118 				; OO  OO OO  OO OO  OO OO   OO OOOOOO OO     OO  OO OO  OO  OO    OO   OO  OO OO
   119 				; OO  OO OO     OO  OO OO O OO         OOOO  OO  OO OO      OO    OO   OOOOOO  OOOO
   120 				; OO  OO OO     OO  OO OO O OO            OO OOOOO  OO      OO    OO   OO         OO
   121 				;  OOOOO OO      OOOOO  OO OO          OOOO  OO     OO     OOOO    OOO  OOOO   OOOO
   122 				;                                            OO
   123
   124 				; draws always all sprites
   125 				; may only start from VCOUNT >= 105, otherwise it flickers heavily and display errors occur
   126 25BB			@show_sprites
   127 25BB A0 00		    ldy #0
   128 25BD 8C DD 25		    sty spr_flag
   129
   130 25C0 AD 40 25		    lda @sprite_x           ; only sprites with X-Position != 0 will display
   131 25C3 F0 03		    beq no_spieler
   132
   133 25C5 20 EC 25		    jsr print_sprite        ; player sprite 0 never flicker!
   134 				                            ; TIP: Take the lightest color! The darker, the less flickering is noticeable.
   135 25C8			no_spieler
   136 25C8 AC D9 25		    ldy last_sprite
   137
   138 25CB			loop3
   139 25CB B9 40 25		    lda @sprite_x,y
   140 25CE F0 03		    beq no_print_sprite
   141
   142 25D0 20 EC 25		    jsr print_sprite        ; Y register contains sprite number, Akku the X position
   143
   144 25D3			no_print_sprite
   145 25D3 88			    dey
   146 25D4 D0 02		    bne there_are_more_sprites
   147 25D6 A0 17		    ldy #MAX_SPRITES-1
   148
   149 25D8			there_are_more_sprites
   150 25D8 C0 00		    cpy last_sprite: #$00
   151 25DA D0 EF		    bne loop3
   152
   153 25DC A9 00		    lda spr_flag: #$00
   154 25DE F0 03		    beq no_start
   155 25E0 8D D9 25		    sta last_sprite
   156
   157 25E3			no_start
   158 25E3 60			    rts
   159
   160
   161 25E4 00 1F 34 46 55 61 + branch_y dta $00,$1f,$34,$46,$55,$61,$6a,$70
   162
   163
   164 				; Draw a sprite. current number [0 to MAX_SPRITE-1] in Y register
   165 25EC			print_sprite
   166 				;    lda #$32
   167 				;    sta colbk
   168
   169 25EC B9 58 25		    lda @sprite_y,y    ; bereits gelesen
   170
   171 				;    cmp #POSY_MIN     ; check Y position, code is not need here
   172 				;    bcc quit
   173 				;    cmp #POSY_MAX
   174 				;    bcs quit
   175
   176 25EF 8D 14 26		    sta block_y
   177
   178 25F2 29 07		    and #7
   179 25F4 AA			    tax
   180 25F5 BD E4 25		    lda branch_y,x
   181
   182 25F8 48			    pha                ; line within a block
   183 				    
   184 25F9 D0 18		    bne no_dex
   185 				    
   186 25FB AD 14 26		    lda block_y
   187 25FE 4A			    lsr
   188 25FF 4A			    lsr
   189 2600 4A			    lsr
   190 2601 AA			    tax                ; first block number
   191
   192 2602 CA			    dex                ; if dy == 0, then decrement the number of the first block
   193
   194 2603 BD 20 25		    lda block_status,x
   195 2606 1D 21 25		    ora block_status+1,x
   196 2609 1D 22 25		    ora block_status+2,x
   197
   198 260C 0A			    asl @
   199 260D 8D 11 26		    sta print_+1
   200
   201 2610			print_
   202 2610 6C 00 25		    jmp (tab_print_sprite)
   203
   204
   205 				; We have block lines (each 8 real lines high) in here a sprite is moving
   206 2613			no_dex
   207 2613 A9 00		    lda block_y: #$00
   208 2615 4A			    lsr
   209 2616 4A			    lsr
   210 2617 4A			    lsr
   211 2618 AA			    tax                ; first block number
   212
   213 2619 BD 20 25		    lda block_status,x
   214 261C 1D 21 25		    ora block_status+1,x
   215 261F 1D 22 25		    ora block_status+2,x
   216
   217 2622 0A			    asl @
   218 2623 8D 27 26		    sta print+1
   219
   220 2626			print
   221 2626 6C 00 25		    jmp (tab_print_sprite)
   222
   223
   224 				;    lsr
   225 				;    bcc print_sprite_0
   226 				;    lsr
   227 				;    bcc print_sprite_1
   228 				;    lsr
   229 				;    bcc print_sprite_2
   230 				;    lsr
   231 				;    bcc print_sprite_3
   232
   233 2629			print_sprite_null
   234
   235 2629 68			    pla
   236
   237 				; here it is not possible to draw a sprite
   238 262A AD DD 25		    lda spr_flag
   239 262D D0 03		    bne quit
   240 262F 8C DD 25		    sty spr_flag
   241 2632			quit
   242 2632 60			    rts
   243
   244
   245 				; Y register contains sprite number [0 bis MAX_SPRITES-1]
   246 				; X register contains current Y position on the screen (*8 for real height)
   247 2633			print_sprite_0
   248 2633 68			    pla
   249 2634 8D C0 26		    sta clear_sprite_0+1
   250
   251 2637 FE 20 25		    inc block_status,x
   252 263A FE 22 25		    inc block_status+2,x
   253
   254 				; Set the position and color of sprites in the block
   255 263D BD 83 24		    lda block_x0+3,x
   256 2640 D0 03		    bne no_inc
   257 2642 FE 83 24		    inc block_x0+3,x
   258 2645			no_inc
   259 2645 B9 40 25		    lda @sprite_x,y        ; sprite 0
   260 2648 9D 80 24		    sta block_x0,x
   261
   262 264B B9 88 25		    lda @sprite_color,y
   263 264E 9D 00 24		    sta block_c0,x
   264
   265 2651 B9 70 25		    lda @sprite_shape,y    ; in A register is now the sprite shape content
   266
   267 2654			shape_0
   268 				;    sty nr_sprite
   269 2654 AE 14 26		    ldx block_y                   ; Y position in screen
   270
   271 2657			set_sprite_0
   272 2657			    ____player $0400              ; draw the sprite
Macro: ____PLAYER [Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm]
     1 2657 8C BC 26		 sty nr_sprite+1
     2 265A A8			 tay
     4 265B B9 00 2B 9D 00 B4 +  :+16 mva data+#*$100,y pmadr+$0400+#,x
     6 26BB			nr_sprite
     7 26BB A0 00		 ldy #$00
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm
   273
   274 				    ;ldy nr_sprite
   275
   276 				;    lda #$81 ; with this byte it is very easy to see how the players are used.
   277 				;    ldx block_y                  ; Y position in screen
   278 26BD A9 00		    lda #0
   279 26BF			clear_sprite_0
   280 26BF F0 00		    beq cls0                      ; jump to the clear routine
   281
   282 26C1			    .pages
   283 				; very fast clear functions due to unroll loops
   284
   285 26C1			cls0
   286 26C1 9D 11 B4		    sta pmadr+$400+$11,x
   287
   288 26C4 9D 10 B4		    sta pmadr+$400+$10,x
   289
   290 26C7 9D F8 B3		    sta pmadr+$400-8,x
   291 26CA 9D F9 B3		    sta pmadr+$400-7,x
   292 26CD 9D FA B3		    sta pmadr+$400-6,x
   293 26D0 9D FB B3		    sta pmadr+$400-5,x
   294 26D3 9D FC B3		    sta pmadr+$400-4,x
   295 26D6 9D FD B3		    sta pmadr+$400-3,x
   296 26D9 9D FE B3		    sta pmadr+$400-2,x
   297 26DC 9D FF B3		    sta pmadr+$400-1,x
   298
   299 26DF 60			    rts
   300
   301 26E0			cls1
   302 26E0 9D 13 B4		    sta pmadr+$400+$13,x
   303 26E3 9D 14 B4		    sta pmadr+$400+$14,x
   304 26E6 9D 15 B4		    sta pmadr+$400+$15,x
   305 26E9 9D 16 B4		    sta pmadr+$400+$16,x
   306 26EC 9D 17 B4		    sta pmadr+$400+$17,x
   307 26EF 9D 18 B4		    sta pmadr+$400+$18,x
   308 26F2 4C 43 27		    jmp cls7_36
   309
   310 26F5			cls2
   311 26F5 9D 13 B4		    sta pmadr+$400+$13,x
   312 26F8 9D 14 B4		    sta pmadr+$400+$14,x
   313 26FB 9D 15 B4		    sta pmadr+$400+$15,x
   314 26FE 9D 16 B4		    sta pmadr+$400+$16,x
   315 2701 9D 17 B4		    sta pmadr+$400+$17,x
   316 2704 4C 40 27		    jmp cls7_30
   317
   318 2707			cls3
   319 2707 9D 13 B4		    sta pmadr+$400+$13,x
   320 270A 9D 14 B4		    sta pmadr+$400+$14,x
   321 270D 9D 15 B4		    sta pmadr+$400+$15,x
   322 2710 9D 16 B4		    sta pmadr+$400+$16,x
   323 2713 4C 3D 27		    jmp cls7_24
   324
   325 2716			cls4
   326 2716 9D 13 B4		    sta pmadr+$400+$13,x
   327 2719 9D 14 B4		    sta pmadr+$400+$14,x
   328 271C 9D 15 B4		    sta pmadr+$400+$15,x
   329 271F 4C 3A 27		    jmp cls7_18
   330
   331
   332 2722			cls5
   333 2722 9D 13 B4		    sta pmadr+$400+$13,x
   334 2725 9D 14 B4		    sta pmadr+$400+$14,x
   335 2728 4C 37 27		    jmp cls7_12
   336
   337 272B			cls6
   338 272B 9D 13 B4		    sta pmadr+$400+$13,x
   339 272E 4C 34 27		    jmp cls7_6
   340
   341
   342 2731			cls7
   343 2731 9D F9 B3		    sta pmadr+$400-7,x
   344 2734			cls7_6
   345 2734 9D FA B3		    sta pmadr+$400-6,x
   346 2737			cls7_12
   347 2737 9D FB B3		    sta pmadr+$400-5,x
   348 273A			cls7_18
   349 273A 9D FC B3		    sta pmadr+$400-4,x
   350 273D			cls7_24
   351 273D 9D FD B3		    sta pmadr+$400-3,x
   352 2740			cls7_30
   353 2740 9D FE B3		    sta pmadr+$400-2,x
   354 2743			cls7_36
   355 2743 9D FF B3		    sta pmadr+$400-1,x
   356
   357 2746 9D 10 B4		    sta pmadr+$400+$10,x
   358 2749 9D 11 B4		    sta pmadr+$400+$11,x
   359 274C 9D 12 B4		    sta pmadr+$400+$12,x
   360 274F 60			    rts
   361
   362 2750			    .endpg
   363
   364
   365 2750			print_sprite_1
   366 2750 68			    pla
   367 2751 8D E7 27		    sta clear_sprite_1+1
   368
   369 2754 A9 02		    lda #2
   370 2756 1D 20 25		    ora block_status,x     ; Claim the selected sprite in status
   371 2759 9D 20 25		    sta block_status,x
   372 275C A9 02		    lda #2
   373 275E 1D 22 25		    ora block_status+2,x
   374 2761 9D 22 25		    sta block_status+2,x
   375
   376
   377 2764 BD A3 24		    lda block_x1+3,x
   378 2767 D0 03		    bne no_inc2
   379 2769 FE A3 24		    inc block_x1+3,x
   380 276C			no_inc2
   381 276C B9 40 25		    lda @sprite_x,y        ; sprite 1
   382 276F 9D A0 24		    sta block_x1,x
   383
   384 2772 B9 88 25		    lda @sprite_color,y
   385 2775 9D 20 24		    sta block_c1,x
   386
   387 2778 B9 70 25		    lda @sprite_shape,y
   388
   389 277B			shape_1
   390 				;    sty nr_sprite
   391 277B AE 14 26		    ldx block_y
   392
   393 277E			set_sprite_1
   394 277E			    ____player $0500
Macro: ____PLAYER [Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm]
     1 277E 8C E3 27		 sty nr_sprite+1
     2 2781 A8			 tay
     4 2782 B9 00 2B 9D 00 B5 +  :+16 mva data+#*$100,y pmadr+$0500+#,x
     6 27E2			nr_sprite
     7 27E2 A0 00		 ldy #$00
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm
   395
   396 				;    ldy nr_sprite
   397 				;    ldx block_y                   ; Y position in screen
   398 27E4 A9 00		    lda #0
   399 27E6			clear_sprite_1
   400 27E6 F0 00		    beq cls0b
   401
   402 27E8			    .pages
   403 				; very fast clear functions due to unroll loops
   404
   405 27E8			cls0b
   406 27E8 9D 11 B5		    sta pmadr+$500+$11,x
   407
   408 27EB 9D 10 B5		    sta pmadr+$500+$10,x
   409
   410 27EE 9D F8 B4		    sta pmadr+$500-8,x
   411 27F1 9D F9 B4		    sta pmadr+$500-7,x
   412 27F4 9D FA B4		    sta pmadr+$500-6,x
   413 27F7 9D FB B4		    sta pmadr+$500-5,x
   414 27FA 9D FC B4		    sta pmadr+$500-4,x
   415 27FD 9D FD B4		    sta pmadr+$500-3,x
   416 2800 9D FE B4		    sta pmadr+$500-2,x
   417 2803 9D FF B4		    sta pmadr+$500-1,x
   418
   419 2806 60			    rts
   420
   421 2807			cls1b
   422 2807 9D 13 B5		    sta pmadr+$500+$13,x
   423 280A 9D 14 B5		    sta pmadr+$500+$14,x
   424 280D 9D 15 B5		    sta pmadr+$500+$15,x
   425 2810 9D 16 B5		    sta pmadr+$500+$16,x
   426 2813 9D 17 B5		    sta pmadr+$500+$17,x
   427 2816 9D 18 B5		    sta pmadr+$500+$18,x
   428 2819 4C 6A 28		    jmp cls7b_36
   429
   430
   431 281C			cls2b
   432 281C 9D 13 B5		    sta pmadr+$500+$13,x
   433 281F 9D 14 B5		    sta pmadr+$500+$14,x
   434 2822 9D 15 B5		    sta pmadr+$500+$15,x
   435 2825 9D 16 B5		    sta pmadr+$500+$16,x
   436 2828 9D 17 B5		    sta pmadr+$500+$17,x
   437 282B 4C 67 28		    jmp cls7b_30
   438
   439 282E			cls3b
   440 282E 9D 13 B5		    sta pmadr+$500+$13,x
   441 2831 9D 14 B5		    sta pmadr+$500+$14,x
   442 2834 9D 15 B5		    sta pmadr+$500+$15,x
   443 2837 9D 16 B5		    sta pmadr+$500+$16,x
   444 283A 4C 64 28		    jmp cls7b_24
   445
   446 283D			cls4b
   447 283D 9D 13 B5		    sta pmadr+$500+$13,x
   448 2840 9D 14 B5		    sta pmadr+$500+$14,x
   449 2843 9D 15 B5		    sta pmadr+$500+$15,x
   450 2846 4C 61 28		    jmp cls7b_18
   451
   452 2849			cls5b
   453 2849 9D 13 B5		    sta pmadr+$500+$13,x
   454 284C 9D 14 B5		    sta pmadr+$500+$14,x
   455 284F 4C 5E 28		    jmp cls7b_12
   456
   457
   458 2852			cls6b
   459 2852 9D 13 B5		    sta pmadr+$500+$13,x
   460 2855 4C 5B 28		    jmp cls7b_6
   461
   462 2858			cls7b
   463 2858 9D F9 B4		    sta pmadr+$500-7,x
   464 285B			cls7b_6
   465 285B 9D FA B4		    sta pmadr+$500-6,x
   466 285E			cls7b_12
   467 285E 9D FB B4		    sta pmadr+$500-5,x
   468 2861			cls7b_18
   469 2861 9D FC B4		    sta pmadr+$500-4,x
   470 2864			cls7b_24
   471 2864 9D FD B4		    sta pmadr+$500-3,x
   472 2867			cls7b_30
   473 2867 9D FE B4		    sta pmadr+$500-2,x
   474 286A			cls7b_36
   475 286A 9D FF B4		    sta pmadr+$500-1,x
   476
   477 286D 9D 10 B5		    sta pmadr+$500+$10,x
   478 2870 9D 11 B5		    sta pmadr+$500+$11,x
   479 2873 9D 12 B5		    sta pmadr+$500+$12,x
   480 2876 60			    rts
   481
   482 2877			    .endpg
   483
   484
   485 2877			print_sprite_2
   486 2877 68			    pla
   487 2878 8D 0E 29		    sta clear_sprite_2+1
   488
   489 287B A9 04		    lda #4
   490 287D 1D 20 25		    ora block_status,x    ;Claim the selected sprite in status
   491 2880 9D 20 25		    sta block_status,x
   492 2883 A9 04		    lda #4
   493 2885 1D 22 25		    ora block_status+2,x
   494 2888 9D 22 25		    sta block_status+2,x
   495
   496
   497 288B BD C3 24		    lda block_x2+3,x
   498 288E D0 03		    bne no_inc3
   499 2890 FE C3 24		    inc block_x2+3,x
   500 2893			no_inc3
   501 2893 B9 40 25		    lda @sprite_x,y        ; sprite 2
   502 2896 9D C0 24		    sta block_x2,x
   503
   504 2899 B9 88 25		    lda @sprite_color,y
   505 289C 9D 40 24		    sta block_c2,x
   506
   507 289F B9 70 25		    lda @sprite_shape,y
   508
   509 28A2			shape_2
   510 				;    sty nr_sprite
   511 28A2 AE 14 26		    ldx block_y
   512
   513 28A5			set_sprite_2
   514 28A5			    ____player $0600
Macro: ____PLAYER [Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm]
     1 28A5 8C 0A 29		 sty nr_sprite+1
     2 28A8 A8			 tay
     4 28A9 B9 00 2B 9D 00 B6 +  :+16 mva data+#*$100,y pmadr+$0600+#,x
     6 2909			nr_sprite
     7 2909 A0 00		 ldy #$00
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm
   515
   516 				;    ldy nr_sprite
   517 				;    ldx block_y                   ; Y position in screen
   518 290B A9 00		    lda #0
   519 290D			clear_sprite_2
   520 290D F0 00		    beq cls0c
   521
   522
   523 290F			    .pages
   524 				; very fast clear functions due to unroll loops
   525
   526 290F			cls0c
   527 290F 9D 11 B6		    sta pmadr+$600+$11,x
   528
   529 2912 9D 10 B6		    sta pmadr+$600+$10,x
   530
   531 2915 9D F8 B5		    sta pmadr+$600-8,x
   532 2918 9D F9 B5		    sta pmadr+$600-7,x
   533 291B 9D FA B5		    sta pmadr+$600-6,x
   534 291E 9D FB B5		    sta pmadr+$600-5,x
   535 2921 9D FC B5		    sta pmadr+$600-4,x
   536 2924 9D FD B5		    sta pmadr+$600-3,x
   537 2927 9D FE B5		    sta pmadr+$600-2,x
   538 292A 9D FF B5		    sta pmadr+$600-1,x
   539
   540 292D 60			    rts
   541
   542 292E			cls1c
   543 292E 9D 13 B6		    sta pmadr+$600+$13,x
   544 2931 9D 14 B6		    sta pmadr+$600+$14,x
   545 2934 9D 15 B6		    sta pmadr+$600+$15,x
   546 2937 9D 16 B6		    sta pmadr+$600+$16,x
   547 293A 9D 17 B6		    sta pmadr+$600+$17,x
   548 293D 9D 18 B6		    sta pmadr+$600+$18,x
   549 2940 4C 91 29		    jmp cls7c_36
   550
   551
   552 2943			cls2c
   553 2943 9D 13 B6		    sta pmadr+$600+$13,x
   554 2946 9D 14 B6		    sta pmadr+$600+$14,x
   555 2949 9D 15 B6		    sta pmadr+$600+$15,x
   556 294C 9D 16 B6		    sta pmadr+$600+$16,x
   557 294F 9D 17 B6		    sta pmadr+$600+$17,x
   558 2952 4C 8E 29		    jmp cls7c_30
   559
   560 2955			cls3c
   561 2955 9D 13 B6		    sta pmadr+$600+$13,x
   562 2958 9D 14 B6		    sta pmadr+$600+$14,x
   563 295B 9D 15 B6		    sta pmadr+$600+$15,x
   564 295E 9D 16 B6		    sta pmadr+$600+$16,x
   565 2961 4C 8B 29		    jmp cls7c_24
   566
   567 2964			cls4c
   568 2964 9D 13 B6		    sta pmadr+$600+$13,x
   569 2967 9D 14 B6		    sta pmadr+$600+$14,x
   570 296A 9D 15 B6		    sta pmadr+$600+$15,x
   571 296D 4C 88 29		    jmp cls7c_18
   572
   573 2970			cls5c
   574 2970 9D 13 B6		    sta pmadr+$600+$13,x
   575 2973 9D 14 B6		    sta pmadr+$600+$14,x
   576 2976 4C 85 29		    jmp cls7c_12
   577
   578
   579 2979			cls6c
   580 2979 9D 13 B6		    sta pmadr+$600+$13,x
   581 297C 4C 82 29		    jmp cls7c_6
   582
   583 297F			cls7c
   584 297F 9D F9 B5		    sta pmadr+$600-7,x
   585 2982			cls7c_6
   586 2982 9D FA B5		    sta pmadr+$600-6,x
   587 2985			cls7c_12
   588 2985 9D FB B5		    sta pmadr+$600-5,x
   589 2988			cls7c_18
   590 2988 9D FC B5		    sta pmadr+$600-4,x
   591 298B			cls7c_24
   592 298B 9D FD B5		    sta pmadr+$600-3,x
   593 298E			cls7c_30
   594 298E 9D FE B5		    sta pmadr+$600-2,x
   595 2991			cls7c_36
   596 2991 9D FF B5		    sta pmadr+$600-1,x
   597
   598 2994 9D 10 B6		    sta pmadr+$600+$10,x
   599 2997 9D 11 B6		    sta pmadr+$600+$11,x
   600 299A 9D 12 B6		    sta pmadr+$600+$12,x
   601 299D 60			    rts
   602
   603 299E			    .endpg
   604
   605
   606 299E			print_sprite_3
   607 299E 68			    pla
   608 299F 8D 35 2A		    sta clear_sprite_3+1
   609
   610 29A2 A9 08		    lda #8
   611 29A4 1D 20 25		    ora block_status,x     ;Claim the selected sprite in status
   612 29A7 9D 20 25		    sta block_status,x
   613 29AA A9 08		    lda #8
   614 29AC 1D 22 25		    ora block_status+2,x
   615 29AF 9D 22 25		    sta block_status+2,x
   616
   617
   618 29B2 BD E3 24		    lda block_x3+3,x
   619 29B5 D0 03		    bne no_inc4
   620 29B7 FE E3 24		    inc block_x3+3,x
   621 29BA			no_inc4
   622 29BA B9 40 25		    lda @sprite_x,y        ; sprite 3
   623 29BD 9D E0 24		    sta block_x3,x
   624
   625 29C0 B9 88 25		    lda @sprite_color,y
   626 29C3 9D 60 24		    sta block_c3,x
   627
   628 29C6 B9 70 25		    lda @sprite_shape,y
   629
   630 29C9			shape_3
   631 				;    sty nr_sprite
   632 29C9 AE 14 26		    ldx block_y
   633
   634 29CC			set_sprite_3
   635 29CC			    ____player $0700
Macro: ____PLAYER [Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm]
     1 29CC 8C 31 2A		 sty nr_sprite+1
     2 29CF A8			 tay
     4 29D0 B9 00 2B 9D 00 B7 +  :+16 mva data+#*$100,y pmadr+$0700+#,x
     6 2A30			nr_sprite
     7 2A30 A0 00		 ldy #$00
Source: D:\!Delphi\mads\examples\sprites\shanti_2c\multi-sprite-multiplexer.asm
   636
   637 				;    ldy nr_sprite
   638 				;    ldx block_y
   639 2A32 A9 00		    lda #0
   640 2A34			clear_sprite_3
   641 2A34 F0 00		    beq cls0d
   642
   643
   644 2A36			    .pages
   645 				; very fast clear functions due to unroll loops
   646
   647 2A36			cls0d
   648 2A36 9D 11 B7		    sta pmadr+$700+$11,x
   649
   650 2A39 9D 10 B7		    sta pmadr+$700+$10,x
   651
   652 2A3C 9D F8 B6		    sta pmadr+$700-8,x
   653 2A3F 9D F9 B6		    sta pmadr+$700-7,x
   654 2A42 9D FA B6		    sta pmadr+$700-6,x
   655 2A45 9D FB B6		    sta pmadr+$700-5,x
   656 2A48 9D FC B6		    sta pmadr+$700-4,x
   657 2A4B 9D FD B6		    sta pmadr+$700-3,x
   658 2A4E 9D FE B6		    sta pmadr+$700-2,x
   659 2A51 9D FF B6		    sta pmadr+$700-1,x
   660
   661 2A54 60			    rts
   662
   663 2A55			cls1d
   664 2A55 9D 13 B7		    sta pmadr+$700+$13,x
   665 2A58 9D 14 B7		    sta pmadr+$700+$14,x
   666 2A5B 9D 15 B7		    sta pmadr+$700+$15,x
   667 2A5E 9D 16 B7		    sta pmadr+$700+$16,x
   668 2A61 9D 17 B7		    sta pmadr+$700+$17,x
   669 2A64 9D 18 B7		    sta pmadr+$700+$18,x
   670 2A67 4C B8 2A		    jmp cls7d_36
   671
   672
   673 2A6A			cls2d
   674 2A6A 9D 13 B7		    sta pmadr+$700+$13,x
   675 2A6D 9D 14 B7		    sta pmadr+$700+$14,x
   676 2A70 9D 15 B7		    sta pmadr+$700+$15,x
   677 2A73 9D 16 B7		    sta pmadr+$700+$16,x
   678 2A76 9D 17 B7		    sta pmadr+$700+$17,x
   679 2A79 4C B5 2A		    jmp cls7d_30
   680
   681 2A7C			cls3d
   682 2A7C 9D 13 B7		    sta pmadr+$700+$13,x
   683 2A7F 9D 14 B7		    sta pmadr+$700+$14,x
   684 2A82 9D 15 B7		    sta pmadr+$700+$15,x
   685 2A85 9D 16 B7		    sta pmadr+$700+$16,x
   686 2A88 4C B2 2A		    jmp cls7d_24
   687
   688 2A8B			cls4d
   689 2A8B 9D 13 B7		    sta pmadr+$700+$13,x
   690 2A8E 9D 14 B7		    sta pmadr+$700+$14,x
   691 2A91 9D 15 B7		    sta pmadr+$700+$15,x
   692 2A94 4C AF 2A		    jmp cls7d_18
   693
   694 2A97			cls5d
   695 2A97 9D 13 B7		    sta pmadr+$700+$13,x
   696 2A9A 9D 14 B7		    sta pmadr+$700+$14,x
   697 2A9D 4C AC 2A		    jmp cls7d_12
   698
   699
   700 2AA0			cls6d
   701 2AA0 9D 13 B7		    sta pmadr+$700+$13,x
   702 2AA3 4C A9 2A		    jmp cls7d_6
   703
   704 2AA6			cls7d
   705 2AA6 9D F9 B6		    sta pmadr+$700-7,x
   706 2AA9			cls7d_6
   707 2AA9 9D FA B6		    sta pmadr+$700-6,x
   708 2AAC			cls7d_12
   709 2AAC 9D FB B6		    sta pmadr+$700-5,x
   710 2AAF			cls7d_18
   711 2AAF 9D FC B6		    sta pmadr+$700-4,x
   712 2AB2			cls7d_24
   713 2AB2 9D FD B6		    sta pmadr+$700-3,x
   714 2AB5			cls7d_30
   715 2AB5 9D FE B6		    sta pmadr+$700-2,x
   716 2AB8			cls7d_36
   717 2AB8 9D FF B6		    sta pmadr+$700-1,x
   718
   719 2ABB 9D 10 B7		    sta pmadr+$700+$10,x
   720 2ABE 9D 11 B7		    sta pmadr+$700+$11,x
   721 2AC1 9D 12 B7		    sta pmadr+$700+$12,x
   722 2AC4 60			    rts
   723
   724 2AC5			    .endpg
   725
   726
   727 				; Very fast data copy functions due to unroll loops
   728
   729 				.macro	____player (player)
   730 				 sty nr_sprite+1
   731 				 tay
   732 				
   733 				 :+16 mva data+#*$100,y pmadr+:player+#,x
   734 				
   735 				nr_sprite
   736 				 ldy #$00
   737 				.endm
   114
   115
   116 2AC5				.align
   117
   118 2B00-3AFF> 00 00 00 00 + data	ins 'shape\shape.bin'
   119
   120
   121 				.print 'end: ',*
   121 				end: $3B00
   122
   123 02E0-02E1> 20 20			run main
